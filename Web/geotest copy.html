<html> <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoVxauKlXr5UIbGZzMpsao8hc8haGG64Y&callback=initMap"
    type="text/javascript"></script>

    <script type="text/javascript">

      // Load the Visualization API and the controls package.
      google.charts.load('current', {'packages':['controls', 'corechart', 'geochart'],
      'mapsApiKey': 'AIzaSyBoVxauKlXr5UIbGZzMpsao8hc8haGG64Y'});
      

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawAllSheets);

      // Callback that creates and populates a data table,
      // instantiates a dashboard, a range slider and a pie chart,
      // passes in the data and draws it.


    function drawAllSheets() {
    drawSheetName ('Global_Health', 'SELECT A,B,C', drawGeoDashboard);

    
} //drawAllSheetsS
function drawSheetName(sheetName, query, responseHandler){
    var queryString = encodeURIComponent(query);
    var query = new google.visualization.Query(
        'https://docs.google.com/spreadsheets/d/19XH4jbKGMJS6aarHaSE-1GISPpuA377jl5GwWM7XTYU/gviz/tq?sheet='
        + sheetName +'&headers=1&tq=' + queryString );

    query.send(responseHandler)    
}//drawSheetName      


var geo_mode = "Absolute";
function changeView() {

  if(geo_mode == "Absolute"){
    drawSheetName ('Global_Health', 'SELECT A,B,D', drawGeoDashboard);
  geo_mode = "Percent"
}else{
  drawSheetName ('Global_Health', 'SELECT A,B,C', drawGeoDashboard);
  geo_mode = "Absolute"
}

}



function drawGeoDashboard(response) {
  var data = response.getDataTable();
  console.log(data)
 

  //Control wrapper  -  Filters by Year of Data
  var TypePicker = new google.visualization.ControlWrapper({
    'controlType': 'CategoryFilter',
    'containerId': 'filter2_div',
    'options': {
      'filterColumnLabel': 'Years',
      'ui': {
        'label': 'Select Year Range',
        'labelStacking': 'vertical',
        'allowTyping': false, 
        'allowMultiple': false,
        'allowNone' : false  
      }
    },
    state: {
      selectedValues: ['2011-2017']}
  });
  
  //Get range so the gradient range is consistant
  var lim_value;
  var range = data.getColumnRange(2);
  if (range.max > Math.abs(range.min)){
    lim_value = range.max;
  }else{
    lim_value = Math.abs(range.min)
  };



  //Actual chart wrapper here
  var DashColumnChart = new google.visualization.ChartWrapper({
    'chartType': 'GeoChart',
    'containerId': 'chart_div',
    view: {columns: [0,2]},
    options : {
                    chartArea: {width:'60%', height:'60%'},
                    width : 1000,
                    height: 400,
                    colorAxis: {minValue:range.min, maxValue:range.max, colors: ['blue','green','yellow','orange',]},
                    backgroundColor: {fill:"#E0e2e3", },
                    legend: {NumberFormat: "scientific",  textStyle: {fontSize: 14}},
                    magnifyingGlass: {enable:true,  zoomFactor: 7.5}

                          
                }

  });

  //Bind the control wrapers to the data, then draw the chart
  var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div')).
    bind([TypePicker], DashColumnChart).
    draw(data)

} // End of the dashboard script
    </script>
  </head>

  <body>
    <input type="button" value="Toggle Percent/Absolute Change" onclick="changeView()" />
    <!--Div that will hold the dashboard-->
    <div id="dashboard_div">
      <!--Divs that will hold each control and chart-->
      <div id="filter_div"></div>
      <div id="filter2_div"></div>
      <div id="chart_div" style="height: 800px;"></div>
    </div>
  </body>
</html>