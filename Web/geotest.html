<html> <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the controls package.
      google.charts.load('current', {'packages':['controls', 'corechart', 'geochart'],
      'mapsApiKey': 'AIzaSyBoVxauKlXr5UIbGZzMpsao8hc8haGG64Y'});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(initialize);

      // Callback that creates and populates a data table,
      // instantiates a dashboard, a range slider and a pie chart,
      // passes in the data and draws it.
    function initialize() {

 // var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/18BvmXSqMCNpIeoL9rJpELn6GFevH8GcuspQ9qb4leNQ/edit?usp=sharing');


  // Send the query with a callback function.
  //query.send(drawDashboard);


  var queryString = encodeURIComponent('range=A1:L22');
    //var query = new google.visualization.Query(
     //   'https://docs.google.com/spreadsheets/d/16tS1oa14qOgNNWGR3lEaFYIYAoAsCeMbvbJDpsuLsbQ/gviz/tq?sheet='
     //   + 'Dashboard_Health' +'&headers=1&tq?' + 'range=A1:L22' );

     var query = new google.visualization.Query(
       'https://docs.google.com/spreadsheets/d/19XH4jbKGMJS6aarHaSE-1GISPpuA377jl5GwWM7XTYU/gviz/tq?sheet='
        + 'Global_Health' +'&headers=1&tq?' + 'range=A1:D24' ); 
     

    query.send(drawGeoDashboard)    

}

function drawGeoDashboard(response) {
  var data = response.getDataTable();
  console.log(data)
  //First Control wrapper  - Filters by Category of Data
  var namePicker = new google.visualization.ControlWrapper({
    'controlType': 'CategoryFilter',
    'containerId': 'filter_div',
    'options': {
      'filterColumnLabel': 'Type',
      'ui': {
        'label': 'Spending Representation',
        'labelStacking': 'vertical',
        'allowTyping': false, //User gets a text box to type into
        'allowMultiple': false,   /// Lets you select dorp-down options one at a time, can click multiple at a time - Useful but not for here
        'allowNone' : false //disables the "Select a value" - it's confusing
      }
    },
    state: {
      selectedValues: ['Percent Change']
    }
  });

  //Second Control wrapper  - Sliding bar that Filters by Year of Data
  var TypePicker = new google.visualization.ControlWrapper({
    'controlType': 'CategoryFilter',
    'containerId': 'filter2_div',
    'options': {
      'filterColumnLabel': 'Years',
      'ui': {
        'label': 'Select Year Range',
        'labelStacking': 'vertical',
        'allowTyping': false, 
        'allowMultiple': false,
        'allowNone' : false  
      }
    },
    state: {
      selectedValues: ['2011-2017']}
  });
  

  //Actual chart wrapper here
  var DashColumnChart = new google.visualization.ChartWrapper({
    'chartType': 'GeoChart',
    'containerId': 'chart_div',
    view: {columns: [1,3]},
    options : {
                    chartArea: {width:'60%', height:'60%'},
                    width : 1000,
                    height: 400,
                    colorAxis: {colors: ['#201600', '#5F4100', '#9E6D00', '#DD9800', '#FDAE00']},
                    explorer: { 
            actions: ['dragToZoom', 'rightClickToReset'],},          
                
                    //colorAxis: {minValue : -range, maxValue : range,colors: ['blue', 'white', 'red']}
                          
                }

  });

  //Bind the control wrapers to the data, then draw the chart
  var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div')).
    bind([namePicker, TypePicker], DashColumnChart).
    draw(data)

} // End of the dashboard script
    </script>
  </head>

  <body>
    <input type="button" value="Toggle Percent/Absolute Change" onclick="changeView()" />
    <!--Div that will hold the dashboard-->
    <div id="dashboard_div">
      <!--Divs that will hold each control and chart-->
      <div id="filter_div"></div>
      <div id="filter2_div"></div>
      <div id="chart_div" style="height: 800px;"></div>
    </div>
  </body>
</html>